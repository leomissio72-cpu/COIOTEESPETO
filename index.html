<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão - Restaurante</title>
    <style>
        /* Seu CSS permanece EXATAMENTE o mesmo */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* ... (todo o CSS permanece igual) ... */
        
        @media (max-width: 767px) {
            /* ... (todos os media queries permanecem iguais) ... */
        }
    </style>
</head>
<body>
    <!-- Todo o HTML permanece EXATAMENTE igual -->
    <header>
        <div class="container header-content">
            <!-- ... -->
        </div>
    </header>

    <div class="container">
        <!-- ... todas as seções permanecem iguais ... -->
    </div>

    <!-- ... todos os modals permanecem iguais ... -->

    <script>
        // URL do Google Apps Script
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxyfazWub9WjQbNlhgm2NDps5kdnJqByVf0WxctNlc/dev';

        // Função para chamar o Google Apps Script
        async function callGoogleScript(functionName, data = {}) {
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        function: functionName,
                        data: data
                    })
                });
                
                const result = await response.json();
                return result;
            } catch (error) {
                console.error('Erro ao chamar Google Script:', error);
                throw error;
            }
        }

        // Modifique todas as funções que usam google.script.run para usar callGoogleScript
        // Exemplo de como modificar:

        async function carregarProdutos() {
            try {
                const result = await callGoogleScript('getProdutos');
                const produtos = result.data || [];
                const listaProdutos = document.getElementById('lista-produtos');
                
                listaProdutos.innerHTML = '';
                
                if (produtos.length === 0) {
                    listaProdutos.innerHTML = '<tr><td colspan="4" style="text-align: center;">Nenhum produto cadastrado</td></tr>';
                    return;
                }
                
                produtos.forEach((produto, index) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${produto.nome}</td>
                        <td>${produto.categoria}</td>
                        <td>R$ ${produto.preco.toFixed(2)}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-warning" onclick="editarProduto('${produto.id}')">Editar</button>
                                <button class="btn btn-danger" onclick="excluirProduto('${produto.id}')">Excluir</button>
                            </div>
                        </td>
                    `;
                    listaProdutos.appendChild(tr);
                });
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
            }
        }

        async function adicionarProduto() {
            const nome = document.getElementById('nome-produto').value;
            const categoria = document.getElementById('categoria').value;
            const preco = parseFloat(document.getElementById('preco').value);
            const descricao = document.getElementById('descricao').value;
            
            if (!nome || !categoria || !preco) {
                mostrarAlerta('produto-error', 'Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            try {
                const novoProduto = {
                    nome,
                    categoria,
                    preco,
                    descricao
                };
                
                await callGoogleScript('adicionarProduto', novoProduto);
                mostrarAlerta('produto-success', 'Produto cadastrado com sucesso!');
                
                // Limpar formulário
                document.getElementById('nome-produto').value = '';
                document.getElementById('categoria').value = '';
                document.getElementById('preco').value = '';
                document.getElementById('descricao').value = '';
                
                carregarProdutos();
                atualizarDashboard();
            } catch (error) {
                console.error('Erro ao adicionar produto:', error);
                mostrarAlerta('produto-error', 'Erro ao salvar produto. Tente novamente.');
            }
        }

        async function editarProduto(id) {
            try {
                const result = await callGoogleScript('getProdutos');
                const produtos = result.data || [];
                const produto = produtos.find(p => p.id === id);
                
                if (!produto) {
                    mostrarAlerta('produto-error', 'Produto não encontrado.');
                    return;
                }
                
                // Preencher formulário com dados do produto
                document.getElementById('nome-produto').value = produto.nome;
                document.getElementById('categoria').value = produto.categoria;
                document.getElementById('preco').value = produto.preco;
                document.getElementById('descricao').value = produto.descricao || '';
                
                // Alterar para modo edição
                produtoEmEdicao = id;
                document.getElementById('adicionar-produto').textContent = 'Atualizar Produto';
                document.getElementById('cancelar-edicao').classList.remove('hidden');
                
                // Rolar para o formulário
                document.getElementById('produtos').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Erro ao editar produto:', error);
            }
        }

        async function excluirProduto(id) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                try {
                    await callGoogleScript('excluirProduto', { id });
                    carregarProdutos();
                    atualizarDashboard();
                    
                    // Se estava editando o produto excluído, cancelar a edição
                    if (produtoEmEdicao === id) {
                        cancelarEdicao();
                    }
                } catch (error) {
                    console.error('Erro ao excluir produto:', error);
                }
            }
        }

        // Modifique TODAS as outras funções seguindo o mesmo padrão:
        // Substitua google.script.run por callGoogleScript

        // Funções para comandas
        async function carregarComandas() {
            try {
                const result = await callGoogleScript('getComandas');
                const comandas = result.data || [];
                const listaComandas = document.getElementById('comandas-lista');
                
                listaComandas.innerHTML = '';
                
                if (comandas.length === 0) {
                    listaComandas.innerHTML = '<p>Nenhuma comanda ativa</p>';
                    return;
                }
                
                for (const comanda of comandas) {
                    const itensResult = await callGoogleScript('getItensComanda', { comandaId: comanda.id });
                    const itens = itensResult.data || [];
                    const total = itens.reduce((sum, item) => sum + (item.precoUnitario * item.quantidade), 0);
                    
                    const div = document.createElement('div');
                    div.className = 'card';
                    div.innerHTML = `
                        <h3>Comanda #${comanda.id} - ${comanda.cliente || 'Cliente não informado'}</h3>
                        <p><strong>Total:</strong> R$ ${total.toFixed(2)}</p>
                        <p><strong>Itens:</strong> ${itens.length}</p>
                        <p><strong>Status:</strong> <span class="badge badge-success">Ativa</span></p>
                        <button class="btn btn-primary" onclick="abrirModalComanda('${comanda.id}')">Ver/Editar</button>
                    `;
                    listaComandas.appendChild(div);
                }
            } catch (error) {
                console.error('Erro ao carregar comandas:', error);
            }
        }

        async function criarComanda() {
            const cliente = document.getElementById('cliente').value;
            
            if (!cliente) {
                mostrarAlerta('comanda-error', 'Por favor, informe o nome do cliente.');
                return;
            }
            
            try {
                const novaComanda = {
                    cliente: cliente,
                    dataAbertura: new Date().toISOString(),
                    status: 'ativa'
                };
                
                await callGoogleScript('adicionarComanda', novaComanda);
                
                // Limpar formulário
                document.getElementById('cliente').value = '';
                
                mostrarAlerta('comanda-success', 'Comanda criada com sucesso!');
                carregarComandas();
                atualizarDashboard();
            } catch (error) {
                console.error('Erro ao criar comanda:', error);
                mostrarAlerta('comanda-error', 'Erro ao criar comanda. Tente novamente.');
            }
        }

        // Continue modificando todas as outras funções...

        // IMPORTANTE: Você precisará modificar TODAS as funções que fazem chamadas ao Google Apps Script
        // Seguindo o mesmo padrão mostrado acima

        // Sistema de navegação (mantido igual)
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // ... (código permanece igual)
            });
        });

        // ... (restante do código JavaScript permanece igual)

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar eventos (mantido igual)
            document.getElementById('adicionar-produto').addEventListener('click', adicionarProduto);
            document.getElementById('cancelar-edicao').addEventListener('click', cancelarEdicao);
            document.getElementById('criar-comanda').addEventListener('click', criarComanda);
            document.getElementById('filtrar-relatorio').addEventListener('click', carregarRelatorios);
            document.getElementById('exportar-relatorio').addEventListener('click', exportarRelatorio);
            document.getElementById('aplicar-filtros').addEventListener('click', aplicarFiltrosDashboard);
            
            // Carregar dados iniciais
            carregarProdutos();
            carregarComandas();
            carregarRelatorios();
            atualizarDashboard();
            
            // ... (restante da inicialização permanece igual)
        });

    </script>
</body>
</html>
